<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phishing URL Detection</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <style>
        .container {
            margin-top: 50px;
        }
        .toggle-icon {
            cursor: pointer;
            margin-right: 10px;
        }
        .card-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container" style="max-width: 700px">
        <div class="text-center">
            <img src="{{ url_for('static', filename='image.jpg') }}" alt="Phishing URL Detection Logo" class="img-thumbnail" width="200px" height="200px"/>
        </div>
        
        <h1 class="text-center mb-4">Phishing URL Detection</h1>
        <form id="urlForm" class="form-inline justify-content-center mb-4">
            <div class="form-group">
                <input type="url" id="url" name="url" placeholder="Enter URL" class="form-control mr-2" required>
            </div>
            <button type="submit" class="btn btn-primary">Check</button>
        </form>

        <div id="loadingSpinner" class="text-center" style="display:none;">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <p>Processing your request, please wait...</p>
        </div>

        <div id="results" class="collapse">
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="card-title" id="resultText"></h2>
                </div>
            </div>

            <div class="card mb-3 collapse" id="featureExplanation">
                <div class="card-body">
                    <h3 class="card-title">
                        <span>Explanation of Features</span>
                        <i class="toggle-icon fas fa-chevron-right"></i>
                    </h3>                    
                    <ul>
                        <li><strong>-1</strong>: Potentially Malicious.</li>
                        <li><strong>0</strong>: Suspicious.</li>
                        <li><strong>1</strong>: Likely Safe.</li>
                    </ul>
                </div>
            </div>
            
            <div class="card collapse" id="extractedFeatures">
                <div class="card-body">
                    <h3 class="card-title">
                        <span>Extracted Features</span>
                        <i class="toggle-icon fas fa-chevron-right"></i>
                    </h3>                    
                    <div class="table-responsive">
                        <table class="table table-striped" id="featuresTable">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Feature</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="featuresList">
                                <!-- Dynamic content will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Define the feature labels
            const featureLabels = [
                'Using IP', 'Long URL', 'Short URL', 'Symbol @', 'Redirecting //', 'Prefix/Suffix',
                'Sub Domains', 'HTTPS', 'Domain Registration Length', 'Favicon', 'Non-Standard Port',
                'HTTPS Domain URL', 'Request URL', 'Anchor URL', 'Links in &lt;script&gt; tags',
                'Server Form Handler', 'Info Email', 'Abnormal URL', 'Website Forwarding', 'Status Bar Customization',
                'Disable Right Click', 'Using Popup Window', 'Iframe Redirection', 'Age of Domain',
                'DNS Recording', 'Website Traffic', 'Page Rank', 'Google Index', 'Links Pointing to Page',
                'Stats Report'
            ];

            // Handle form submission
            $('#urlForm').on('submit', function(event) {
                event.preventDefault();  // Prevent default form submission
                $('#results').collapse('hide');  // Hide previous results
                $('#loadingSpinner').show();  // Show the loading spinner

                const url = $('#url').val();

                $.ajax({
                    url: '/check_url',  // Adjust the URL if your Flask endpoint is different
                    method: 'POST',
                    contentType: 'application/json',
                    dataType: 'json',
                    data: JSON.stringify({ url: url }),
                    success: function(response) {
                        $('#loadingSpinner').hide();  // Hide the loading spinner
                        
                        // Display the results
                        $('#resultText').text(`${url} ${response.message}`);
                        $('#resultText').removeClass('text-danger text-success');
                        if (response.is_phishing) {
                            $('#resultText').addClass('text-danger');
                        } else {
                            $('#resultText').addClass('text-success');
                        }
                        
                        // Populate the features list
                        if (response.features) {
                            let featuresHtml = '';
                            response.features.forEach(function(feature, index) {
                                let label = featureLabels[index] || 'Unknown';
                                let valueClass = feature === -1 ? 'text-danger' :
                                                 feature === 0 ? 'text-warning' : 'text-success';
                                let valueText = feature === -1 ? 'Potentially Malicious' :
                                                feature === 0 ? 'Suspicious' : 'Likely Safe';
                                
                                featuresHtml += `
                                    <tr>
                                        <td>${label}</td>
                                        <td class="${valueClass}">${valueText}</td>
                                    </tr>
                                `;
                            });
                            $('#featuresList').html(featuresHtml);
                            $('#extractedFeatures, #featureExplanation').collapse('show');  // Show features
                        } else {
                            $('#extractedFeatures, #featureExplanation').collapse('hide');
                        }

                        $('#results').collapse('show');  // Show the results section
                    },
                    error: function(xhr, status, error) {
                        $('#loadingSpinner').hide();  // Hide the loading spinner
                        alert('An error occurred: ' + error);
                    }
                });
            });

            // Handle the toggle icon change on collapse show/hide
            $('#featureExplanation').on('shown.bs.collapse', function () {
                $(this).find('.toggle-icon').removeClass('fa-chevron-right').addClass('fa-chevron-down');
            }).on('hidden.bs.collapse', function () {
                $(this).find('.toggle-icon').removeClass('fa-chevron-down').addClass('fa-chevron-right');
            });

            $('#extractedFeatures').on('shown.bs.collapse', function () {
                $(this).find('.toggle-icon').removeClass('fa-chevron-right').addClass('fa-chevron-down');
            }).on('hidden.bs.collapse', function () {
                $(this).find('.toggle-icon').removeClass('fa-chevron-down').addClass('fa-chevron-right');
            });
        });
    </script>

    <!-- Font Awesome for toggle icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

</body>
</html>
